class AffiliateTracker{constructor(e={}){this.endpoint=e.endpoint||"",this.campaignId=e.campaignId,this.clickId=this.getClickId()||this.generateClickId(),this.screenInfo={resolution:`${window.screen.width}x${window.screen.height}`,viewport:`${window.innerWidth}x${window.innerHeight}`},this.deviceInfo={userAgent:navigator.userAgent,...this.getBrowserInfo(),os:this.getOSInfo(),deviceType:this.getDeviceType(),language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,baseUrl:window.location.origin}}generateClickId(){return`${Date.now()}-${Math.random().toString(36).substring(2,15)}`}getClickId(){const e=new URLSearchParams(window.location.search);return e.get("click_id")||""}getBrowserInfo(){const e=navigator.userAgent;let t="unknown",i="unknown";return/Chrome/.test(e)?(t="Chrome",i=e.match(/Chrome\/(\d+)/)[1]):/Firefox/.test(e)?(t="Firefox",i=e.match(/Firefox\/(\d+)/)[1]):/Safari/.test(e)&&(t="Safari",i=e.match(/Version\/(\d+)/)[1]),{browser:t,version:i}}getDeviceType(){const e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"mobile":"desktop"}getOSInfo(){const e=navigator.userAgent;return/Windows/.test(e)?"Windows":/Mac OS X/.test(e)?"MacOS":/Linux/.test(e)?"Linux":/Android/.test(e)?"Android":/iOS/.test(e)?"iOS":"Unknown"}async trackVisit(){try{const e=await fetch(`${this.endpoint}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({click_id:this.clickId,campaign_id:this.campaignId,...this.deviceInfo,screen_resolution:this.screenInfo.resolution,viewport_size:this.screenInfo.viewport})});const data=await e.json();localStorage.setItem("visitor_id",data.visitor_id);return data}catch(e){throw console.error("Error tracking visit:",e),e}}async trackConversion(e){const t=localStorage.getItem("visitor_id");if(!t){throw new Error("No visitor_id found. Please ensure trackVisit() was called first.")}try{const i=await fetch(`${this.endpoint}/postback`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitor_id:t,click_id:this.clickId,campaign_id:this.campaignId,amount:e})});return await i.json()}catch(e){throw console.error("Error tracking conversion:",e),e}}}
